<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publicity Visual - Noticias Estilo Magazine</title>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="top-left">
                <span class="top-date"><i class="far fa-clock"></i> <span id="current-date"></span></span>
                <span class="top-weather"><i class="fas fa-cloud-sun"></i> 22°C Madrid</span>
            </div>
            <div class="top-social">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-youtube"></i></a>
                <a href="#" class="login-btn"><i class="far fa-user"></i> Iniciar Sesión</a>
            </div>
        </div>
    </div>

    <!-- Main Header -->
    <header class="main-header">
        <div class="container header-inner">
            <div class="logo">
                <a href="/">
                    <h1>Publicity<span class="highlight">Visual</span></h1>
                </a>
            </div>
            <div class="header-ad">
                <div class="ad-placeholder">
                    <span>Espacio Publicitario 728x90</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <div class="main-nav-wrap">
        <div class="container relative">
            <nav class="main-nav">
                <ul class="main-menu" id="main-menu">
                    <li class="active"><a href="#" onclick="loadNews('')"><i class="fas fa-home"></i> Inicio</a></li>
                    <li class="has-mega-menu"><a href="#" onclick="loadNews('mundo')">Mundo <i class="fas fa-chevron-down"></i></a></li>
                    <li><a href="#" onclick="loadNews('tecnología')">Tecnología</a></li>
                    <li><a href="#" onclick="loadNews('deportes')">Deportes</a></li>
                    <li><a href="#" onclick="loadNews('entretenimiento')">Entretenimiento</a></li>
                    <li class="menu-alert"><a href="#" onclick="loadNews('última hora')">Última Hora</a></li>
                </ul>
                <div class="nav-actions">
                    <div class="nav-search-icon" id="search-toggle">
                        <i class="fas fa-search"></i>
                    </div>
                     <div class="random-post-icon" onclick="loadNews('random')">
                        <i class="fas fa-random"></i>
                    </div>
                </div>
            </nav>
        </div>
    </div>

    <!-- Breaking News Ticker -->
    <div class="ticker-wrap">
        <div class="container ticker-inner">
            <span class="ticker-label"><i class="fas fa-bolt"></i> TRENDING</span>
            <div class="ticker-content">
                <div class="ticker-item">Bienvenido a Publicity Visual - La mejor fuente de noticias.</div>
                <div class="ticker-item">Última hora: Avances en inteligencia artificial sorprenden al mundo.</div>
                <div class="ticker-item">Deportes: Final de campeonato programada para este domingo.</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-container container">
        
        <!-- Hero Grid -->
        <section class="hero-section">
            <div class="hero-grid" id="hero-grid">
                <!-- Large Item -->
                 <div class="hero-item large loading-skeleton"></div>
                 <!-- Small Items -->
                 <div class="hero-item small loading-skeleton"></div>
                 <div class="hero-item small loading-skeleton"></div>
            </div>
        </section>

        <div class="content-wrapper">
            <!-- Left Sticky Share -->
            <aside class="sticky-share">
                <span class="share-text">COMPARTIR</span>
                <a href="#" class="share-btn fb"><i class="fab fa-facebook-f"></i></a>
                <a href="#" class="share-btn tw"><i class="fab fa-twitter"></i></a>
                <a href="#" class="share-btn wa"><i class="fab fa-whatsapp"></i></a>
                <a href="#" class="share-btn em"><i class="far fa-envelope"></i></a>
            </aside>

            <!-- Main Stream -->
            <main class="main-content">
                <div class="block-header">
                    <h3 class="block-title"><span>Últimas Noticias</span></h3>
                    <div class="block-nav">
                        <span class="active">Todo</span>
                        <span>Populares</span>
                        <span>Tendencias</span>
                    </div>
                </div>

                <div id="loading-news" class="loading-container">
                    <div class="spinner"></div>
                    <p>Cargando noticias...</p>
                </div>

                <div class="posts-list" id="news-container">
                    <!-- Post Items Injected Here -->
                </div>
                
                <div class="load-more-wrap">
                    <button class="btn-load-more" onclick="loadNews('mas')">Cargar Más Noticias</button>
                </div>
            </main>

            <!-- Sidebar -->
            <aside class="main-sidebar">
                <!-- Social Counter Widget -->
                <div class="widget social-counter-widget">
                    <h4 class="widget-title"><span>Síguenos</span></h4>
                    <div class="social-counter-grid">
                        <a href="#" class="sc-item fb">
                            <i class="fab fa-facebook-f"></i>
                            <span class="count">12K</span>
                            <span class="label">Fans</span>
                        </a>
                        <a href="#" class="sc-item tw">
                            <i class="fab fa-twitter"></i>
                            <span class="count">5K</span>
                            <span class="label">Seguidores</span>
                        </a>
                        <a href="#" class="sc-item yt">
                            <i class="fab fa-youtube"></i>
                            <span class="count">25K</span>
                            <span class="label">Subs</span>
                        </a>
                        <a href="#" class="sc-item in">
                            <i class="fab fa-instagram"></i>
                            <span class="count">8K</span>
                            <span class="label">Seguidores</span>
                        </a>
                    </div>
                </div>

                <!-- Ad Widget -->
                <div class="widget ad-widget">
                    <div class="ad-placeholder square">
                        <span>Publicidad 300x250</span>
                    </div>
                </div>

                <!-- Newsletter Widget -->
                <div class="widget newsletter-widget">
                    <h4 class="widget-title"><span>Newsletter</span></h4>
                    <p>Suscríbete para recibir las últimas noticias en tu correo.</p>
                    <form>
                        <input type="email" placeholder="Tu dirección de email">
                        <button type="submit">Suscribirse</button>
                    </form>
                </div>

                 <!-- Categories Widget -->
                 <div class="widget categories-widget">
                   <h4 class="widget-title"><span>Categorías</span></h4>
                   <ul>
                       <li><a href="#">Tecnología <span class="count">12</span></a></li>
                       <li><a href="#">Mundo <span class="count">8</span></a></li>
                       <li><a href="#">Deportes <span class="count">15</span></a></li>
                       <li><a href="#">Entretenimiento <span class="count">6</span></a></li>
                   </ul>
                </div>
            </aside>
        </div>
    </div>

    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-widgets">
                <div class="f-widget about">
                    <div class="f-logo">Publicity<span>Visual</span></div>
                    <p>Tu revista digital de confianza. Noticias verificadas, análisis profundo y la mejor cobertura en tiempo real.</p>
                </div>
                <div class="f-widget links">
                    <h4>Enlaces Útiles</h4>
                    <ul>
                        <li><a href="#">Sobre Nosotros</a></li>
                        <li><a href="#">Contacto</a></li>
                        <li><a href="#">Política de Privacidad</a></li>
                        <li><a href="#">Términos de Uso</a></li>
                    </ul>
                </div>
                 <div class="f-widget tags">
                    <h4>Etiquetas Populares</h4>
                    <div class="tag-cloud">
                        <a href="#">IA</a> <a href="#">Política</a> <a href="#">Bitcoin</a>
                        <a href="#">Cine</a> <a href="#">Fútbol</a> <a href="#">Viral</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="copyright">
            <div class="container">
                <p>&copy; 2024 Publicity Visual. Designed with Jannah Style.</p>
                <div class="copy-social">
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-twitter"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // --- Utils ---
        const formatDate = () => {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return new Date().toLocaleDateString('es-ES', options);
        }

        // --- State ---
        let currentPage = 1;
        let currentQuery = '';
        let isLoading = false;

        // --- Init ---
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('current-date').textContent = formatDate();
            setupMobileMenu();
            loadInitialContent();
        });

        // --- UI Logic ---
        function setupMobileMenu() {
            // Create mobile toggle if not exists (it was missing in previous HTML)
            const navWrap = document.querySelector('.main-nav-wrap .container');
            if(navWrap && !document.getElementById('mobile-toggle')) {
                const toggle = document.createElement('div');
                toggle.id = 'mobile-toggle';
                toggle.className = 'mobile-toggle';
                toggle.innerHTML = '<i class="fas fa-bars"></i>';
                toggle.onclick = () => {
                    const menu = document.getElementById('main-menu');
                    menu.classList.toggle('active');
                };
                // Insert before nav
                navWrap.insertBefore(toggle, navWrap.firstChild);
            }
        }

        async function loadInitialContent() {
            await loadNews();
            // Try to separate some news for the Hero Grid so it doesn't look duplicated
            // Logic handled inside loadNews for simplicity in this specific "demo" context
        }

        async function loadNews(query = '') {
            if (isLoading) return;
            
            const newsContainer = document.getElementById('news-container');
            const loadingElement = document.getElementById('loading-news');
            const loadMoreBtn = document.querySelector('.btn-load-more');

            // Reset state if new query
            if(query !== 'mas') {
                currentQuery = query === 'random' ? '' : query;
                currentPage = 1;
                newsContainer.innerHTML = '';
                // Clear hero if it's a specific search to focus on results? 
                // formatted for Jannah style usually keeps hero static or separate.
            } else {
                currentPage++;
            }

            isLoading = true;
            if(loadingElement) loadingElement.style.display = 'flex';
            if(loadMoreBtn) loadMoreBtn.style.display = 'none';

            try {
                // API doesn't support offset, so we simulate "Load More" by 
                // fetching random categories or just re-fetching for this demo.
                // In a real app, we'd pass &page=${currentPage}
                let q = currentQuery;
                if(query === 'mas') {
                    // Trick to get different news: Search for a random popular topic
                    const topics = ['tecnología', 'mundo', 'ciencia', 'cine', 'viajes'];
                    q = topics[Math.floor(Math.random() * topics.length)];
                }
                
                let apiUrl = `/api/news?limit=10${q ? '&query=' + encodeURIComponent(q) : ''}`;
                
                const response = await fetch(apiUrl);
                if (!response.ok) throw new Error('Network response was not ok');
                
                const data = await response.json();
                
                // --- Hero Logic (Only on first load and no query) ---
                if (currentPage === 1 && !currentQuery) {
                    populateHero(data.articles.slice(0, 3));
                }

                // Render Articles
                // If it's the very first load, skip the first 3 that went to Hero
                const articlesToRender = (currentPage === 1 && !currentQuery) ? data.articles.slice(3) : data.articles;

                if (articlesToRender.length > 0) {
                    articlesToRender.forEach(article => {
                         const card = createNewsItem(article);
                         newsContainer.appendChild(card);
                    });
                } else if (currentPage === 1) {
                    newsContainer.innerHTML = '<div class="no-results">No se encontraron noticias.</div>';
                }

            } catch (error) {
                console.error("Error loading news:", error);
                if(currentPage === 1) {
                     newsContainer.innerHTML = '<div class="error-msg">Error al cargar noticias. Intenta de nuevo.</div>';
                }
            } finally {
                isLoading = false;
                if(loadingElement) loadingElement.style.display = 'none';
                if(loadMoreBtn) loadMoreBtn.style.display = 'block';
            }
        }

        function createNewsItem(article) {
            const date = new Date(article.published_at).toLocaleDateString();
            const div = document.createElement('article');
            div.className = 'post-list-item';
            
            const imgUrl = article.processed_image_url || article.image_url || 'https://via.placeholder.com/300x200?text=News';
            
            div.innerHTML = `
                <div class="post-thumb">
                     <a href="${article.url}" target="_blank">
                        <img src="${imgUrl}" loading="lazy" alt="${article.title}" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                     </a>
                     <span class="cat-tag">${article.category || 'General'}</span>
                </div>
                <div class="post-details">
                    <h3 class="post-title"><a href="${article.url}" target="_blank">${article.title}</a></h3>
                    <div class="post-meta">
                        <span class="meta-author"><i class="far fa-user"></i> ${article.source}</span>
                        <span class="meta-date"><i class="far fa-clock"></i> ${date}</span>
                    </div>
                    <p class="post-excerpt">${article.description || ''}</p>
                </div>
            `;
            return div;
        }

        function populateHero(articles) {
            const heroGrid = document.getElementById('hero-grid');
            if(!articles || articles.length < 3 || !heroGrid) return;
            
            heroGrid.innerHTML = ''; 

            // 1 Large
            const large = articles[0];
            const largeImg = large.processed_image_url || large.image_url || 'https://via.placeholder.com/800x500';
            const largeHTML = `
                <div class="hero-item large">
                    <img src="${largeImg}" alt="${large.title}" onerror="this.src='https://via.placeholder.com/800x500?text=No+Image'">
                    <div class="hero-overlay">
                        <span class="cat-tag bg-red">${large.category || 'Destacado'}</span>
                        <h2 class="hero-title"><a href="${large.url}" target="_blank">${large.title}</a></h2>
                        <div class="hero-meta"><i class="far fa-clock"></i> ${new Date(large.published_at).toLocaleDateString()}</div>
                    </div>
                </div>
            `;
            heroGrid.insertAdjacentHTML('beforeend', largeHTML);

            // 2 Small
            articles.slice(1,3).forEach(art => {
                 const img = art.processed_image_url || art.image_url || 'https://via.placeholder.com/400x250';
                 const smallHTML = `
                    <div class="hero-item small">
                        <img src="${img}" alt="${art.title}" onerror="this.src='https://via.placeholder.com/400x250?text=No+Image'">
                        <div class="hero-overlay">
                            <span class="cat-tag">${art.category || 'News'}</span>
                            <h3 class="hero-title"><a href="${art.url}" target="_blank">${art.title}</a></h3>
                        </div>
                    </div>
                `;
                heroGrid.insertAdjacentHTML('beforeend', smallHTML);
            });
        }
    </script>
</body>
</html>
